<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendar</title>
<link rel="stylesheet" href="styles.css">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f9;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .calendar {
        width: 450px;
        background: white;
        border: 1px solid #ddd;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .calendar-header {
        background: #007bff;
        color: white;
        text-align: center;
        padding: 12px;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .calendar-header button {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        font-size: 18px;
        padding: 5px 12px;
        cursor: pointer;
        border-radius: 4px;
        transition: background 0.2s;
    }

    .calendar-header button:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .calendar-header span {
        flex: 1;
    }

    .calendar-days,
    .calendar-dates {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
    }

    .calendar-days div {
        background: #007bff;
        color: white;
        text-align: center;
        padding: 10px;
        font-weight: bold;
    }

    .calendar-dates div {
        padding: 20px;
        border: 1px solid #ececec;
        text-align: center;
        cursor: default;
    }

    .today {
        background-color: #ffe58a;
        font-weight: bold;
        border: 2px solid #ffcc00;
    }

    .assignment-day {
        background-color: #c3f7c3;
        border: 2px solid #34a853;
    }

    .overdue-day {
        background-color: #f7c3c3;
        border: 2px solid #d93025;
    }

    .other-month {
        color: #ccc;
    }
</style>
</head>
<body>

<button class="nav" onclick="location.href='todo.html'">To-do List</button> <button class="nav">Calendar</button>

<br>

<div class="calendar">
    <div id="calendar-header" class="calendar-header">
        <button id="prevMonth" onclick="changeMonth(-1)">‹</button>
        <span id="monthYear">Month Year</span>
        <button id="nextMonth" onclick="changeMonth(1)">›</button>
    </div>

    <div class="calendar-days">
        <div>Sun</div><div>Mon</div><div>Tue</div>
        <div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>

    <div id="calendar-dates" class="calendar-dates"></div>
</div>

<br>
<button onclick="goToToday()" style="padding: 8px 16px; cursor: pointer;">Go to Today</button>
<br><br>

<div id="assignmentListContainer">

    <h2>Assignments</h2>

    <div id="upcomingSection">
        <h3>Upcoming</h3>
        <div id="upcomingList"></div>
    </div>
    <div id="overdueSection">
        <h3>Overdue</h3>
        <div id="overdueList"></div>
    </div>

    <p id="noAssignmentsMsg">No upcoming assignments!</p>
</div>


<script> // Assignment.js
class Assignment {
    constructor(name, subject="", deadline=null, priority="medium", details="") {
        this.id = this.generateId();
        this.name = name;
        this.subject = subject;
        this.deadline = deadline;      // dd/mm/yyyy
        this.priority = priority;
        this.details = details;
        this.substeps = [];
        this.completed = false;
    }

    generateId() {
        return "assignment_" + Date.now() + "_" + Math.random().toString(36).substring(2,9);
    }

    parseDeadline() {
        if (!this.deadline) return null;

        const parts = this.deadline.split("/");
        if (parts.length !== 3) return null;

        let day = parseInt(parts[0], 10);
        let month = parseInt(parts[1], 10) - 1;
        let year = parseInt(parts[2], 10);

        // allow 2-digit year
        if (year < 100) year += 2000;

        return new Date(year, month, day);
    }

    static fromJSON(data) {
        let a = new Assignment(
            data.name,
            data.subject,
            data.deadline,
            data.priority,
            data.details
        );
        a.id = data.id;
        a.completed = data.completed || false;

        // load substeps if provided
        a.substeps = data.substeps ? data.substeps.map(s => s) : [];

        return a;
    }
}


class AssignmentManager {
    constructor(userId) {
        this.userId = userId;
        this.assignments = [];
        this.loadAssignments();
    }

    loadAssignments() {
        const key = "assignments_" + this.userId;
        const stored = localStorage.getItem(key);
        if (!stored) return;

        const parsed = JSON.parse(stored);
        this.assignments = parsed.map(a => Assignment.fromJSON(a));
    }
}
</script>

<script> // calendar logic with month navigation

// Global variables to track current view
var currentMonth;
var currentYear;
var today = new Date();

// Initialize the calendar with current month
function initCalendar() {
    currentMonth = today.getMonth();
    currentYear = today.getFullYear();
    renderCalendar();
}

// Change month (direction: -1 for previous, 1 for next)
function changeMonth(direction) {
    currentMonth += direction;
    
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    
    renderCalendar();
}

// Go back to today's month
function goToToday() {
    currentMonth = today.getMonth();
    currentYear = today.getFullYear();
    renderCalendar();
}

// renders calendar
function renderCalendar() {
    var monthNames = ["January", "February", "March", "April", "May", "June",
                      "July", "August", "September", "October", "November", "December"];
    
    document.getElementById("monthYear").textContent = monthNames[currentMonth] + " " + currentYear;

    var datesContainer = document.getElementById("calendar-dates");
    datesContainer.innerHTML = "";

    var firstDay = new Date(currentYear, currentMonth, 1).getDay();
    var daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

    // empty slots
    for (var i = 0; i < firstDay; i++) {
        var emptyCell = document.createElement("div");
        datesContainer.appendChild(emptyCell);
    }

    // actual dates
    for (var day = 1; day <= daysInMonth; day++) {
        var cell = document.createElement("div");
        cell.textContent = day;

        // Check if this is today
        if (
            day === today.getDate() &&
            currentMonth === today.getMonth() &&
            currentYear === today.getFullYear()
        ) {
            cell.className = "today";
        }

        datesContainer.appendChild(cell);
    }
    
    // Highlight assignments after rendering
    highlightAssignments();
}


// highlights assignment deadlines
function highlightAssignments() {
    var userId = localStorage.getItem("currentUserId");
    if (!userId) return;

    var manager = new AssignmentManager(userId);
    var assignments = manager.assignments;

    var cells = document.querySelectorAll("#calendar-dates div");
    var firstDay = new Date(currentYear, currentMonth, 1).getDay();

    // loop through assignments
    for (var i = 0; i < assignments.length; i++) {
        var a = assignments[i];
        var dDate = a.parseDeadline();
        if (!dDate) continue;

        var d = dDate.getDate();
        var m = dDate.getMonth();
        var y = dDate.getFullYear();

        if (m !== currentMonth || y !== currentYear) continue;

        var index = firstDay + (d - 1);
        var cell = cells[index];
        if (!cell) continue;

        // Reset the date to start of day for fair comparison
        var todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
        var deadlineStart = new Date(y, m, d);

        if (deadlineStart < todayStart) {
            cell.className += " overdue-day";
        } else {
            cell.className += " assignment-day";
        }
    }
}


// initialize
initCalendar();
</script>

<script> // upcoming or overdue assignments list

function loadCalendarAssignmentList() {
    var userId = localStorage.getItem("currentUserId");
    if (!userId) return;

    var manager = new AssignmentManager(userId);
    var assignments = manager.assignments;

    var overdueList = document.getElementById("overdueList");
    var upcomingList = document.getElementById("upcomingList");

    var overdueSection = document.getElementById("overdueSection");
    var upcomingSection = document.getElementById("upcomingSection");
    var emptyMsg = document.getElementById("noAssignmentsMsg");

    overdueList.innerHTML = "";
    upcomingList.innerHTML = "";

    var todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());

    var foundUpcoming = false;
    var foundOverdue = false;

    for (var i = 0; i < assignments.length; i++) {
        var a = assignments[i];

        // only show uncompleted
        if (a.completed) continue;

        var dDate = a.parseDeadline();
        if (!dDate) continue;

        // build item UI
        var div = document.createElement("div");
        div.style.padding = "6px 0";

        var btn = document.createElement("button");
        btn.textContent = a.name + " — " + (a.subject ? a.subject : "No subject");
        btn.setAttribute("data-id", a.id);
        btn.onclick = function() {
            var ID = this.getAttribute("data-id");
            window.location.href = "assignmentEditor.html?id=" + ID;
        };

        var dateSpan = document.createElement("span");
        dateSpan.style.marginLeft = "10px";
        dateSpan.textContent = a.deadline ? a.deadline : "";

        div.appendChild(btn);
        div.appendChild(dateSpan);

        // overdue vs upcoming
        if (dDate < todayStart) {
            overdueList.appendChild(div);
            foundOverdue = true;
        } else {
            upcomingList.appendChild(div);
            foundUpcoming = true;
        }
    }

    overdueSection.style.display = foundOverdue ? "block" : "none";
    upcomingSection.style.display = foundUpcoming ? "block" : "none";

    emptyMsg.style.display = (!foundUpcoming && !foundOverdue) ? "block" : "none";
}

loadCalendarAssignmentList();
</script>

</body>
</html>
