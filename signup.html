<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign Up</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            align-items: center;
        }
    </style>

</head>
<body>

<h1>Assignment Manager</h1>
<h3>Sign Up</h3>

<form id="signupForm">
    <label>Username:</label>
    <input type="text" id="username"><br><br>

    <label>Password:</label>
    <input type="password" id="password"><br><br>

    <p id="errorMessage" style="color:red;"></p>

    <input class="nav" type="button" value="CREATE ACCOUNT" id="signupBtn">
</form>

<script>
// User class
class User {
    constructor(username, password){
        this.id = this.generateId();
        this.username = username;
        this.password = password;
    }

    generateId(){
        return "user_" + Date.now() + "_" + Math.random().toString(36).substring(2, 9);
    }

    validatePassword(password) {
        return this.password === password;
    }

    toJSON() {
        return {
            id: this.id,
            username: this.username,
            password: this.password
        };
    }
}

// AuthManager class
class AuthManager{
    constructor(){
    const storedUsers = JSON.parse(localStorage.getItem("users")) || [];
    // Convert plain objects back into User instances
    this.users = storedUsers.map(userData => {
        const user = new User(userData.username, userData.password);
        user.id = userData.id; // Preserve the original ID
        return user;
    });
    this.currentUserId = null;
}

    userExists(username) {
        for (let i = 0; i < this.users.length; i++) {
            if (this.users[i].username === username) {
                return true;
            }
        }
        return false;
    }

    signUp(username, password){
        const errorMessage = document.getElementById("errorMessage");
        
        if (this.userExists(username)){
            errorMessage.textContent = "Username already exists.";
            return false;
        }

        const newUser = new User(username, password);
        this.users.push(newUser);
        localStorage.setItem("users", JSON.stringify(this.users)); 
        
        this.currentUserId = newUser.id;
        localStorage.setItem("currentUserId", newUser.id);
    
        return newUser;
    }

    login(username, password){
        const errorMessage = document.getElementById("errorMessage");
        let user = null;

        for (let i = 0; i < this.users.length; i++){
            if (this.users[i].username === username) {
                user = this.users[i];
                break;
            }
        }

        if(!user || !user.validatePassword(password)){
            errorMessage.textContent = "Username or password are incorrect.";
            return false;
        }

        this.currentUserId = user.id;
        localStorage.setItem("currentUserId", user.id);
        
        return true;
    }
}

// Signup logic
const auth = new AuthManager();

document.getElementById("signupBtn").onclick = function () {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const errorMessage = document.getElementById("errorMessage");

    if (!username || !password) {
        errorMessage.textContent = "Please fill all fields.";
        return;
    }

    const newUser = auth.signUp(username, password);
    if (!newUser) return; // Only null if username exists

    window.location.href = "todo.html";
};
</script>

</body>
</html>